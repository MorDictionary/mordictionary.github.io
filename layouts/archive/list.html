{{/* Tumblr-like archive grouped by month (works on Hugo v0.152+) */}}
{{ $sections := site.Params.mainSections | default (slice "posts" "post") }}
{{ $pages := (where site.RegularPages "Section" "in" $sections).ByDate.Reverse }}
{{ $groups := $pages.GroupByDate "January 2006" }}

<section class="tumblr-archive">
  {{ range $groups }}
    <h2 class="ta-month">{{ .Key }}</h2>
    <div class="ta-grid">
      {{ range .Pages }}
        {{ $img := "" }}
        {{ with .Params.cover }}{{ $img = . }}{{ end }}
        {{ if and (eq $img "") (.Params.images) }}{{ $img = index .Params.images 0 }}{{ end }}
        {{ if eq $img "" }}{{ $img = "images/placeholder.png" }}{{ end }}

        <a class="ta-tile" href="{{ .RelPermalink }}" title="{{ .Title }}">
          <img src="{{ $img | relURL }}" alt="{{ .Title }}" loading="lazy">
        </a>
      {{ end }}
    </div>
  {{ end }}
</section>